#!/bin/bash

# Script para comparar stacks de observabilidade: Datadog vs Grafana
# Uso: ./comparar-observabilidade.sh [datadog|grafana|hibrido|custos]

function show_datadog_stack() {
    echo "ğŸ• DATADOG SaaS STACK"
    echo "===================="
    echo ""
    echo "ğŸ“Š Componentes:"
    echo "   â€¢ APM Agentless (dd-trace)"
    echo "   â€¢ Infrastructure Monitoring"
    echo "   â€¢ Log Management"
    echo "   â€¢ Real User Monitoring (RUM)"
    echo "   â€¢ Synthetic Monitoring"
    echo "   â€¢ AI-powered Alerts"
    echo ""
    echo "âœ… Vantagens:"
    echo "   â€¢ Zero maintenance"
    echo "   â€¢ Rich feature set"
    echo "   â€¢ Auto-correlation"
    echo "   â€¢ Enterprise support"
    echo "   â€¢ Quick time-to-value"
    echo ""
    echo "âŒ Desvantagens:"
    echo "   â€¢ Alto custo (~$325/mÃªs)"
    echo "   â€¢ Vendor lock-in"
    echo "   â€¢ Limited customization"
    echo "   â€¢ Data sovereignty concerns"
    echo ""
    echo "ğŸ¯ Melhor para:"
    echo "   â€¢ ProduÃ§Ã£o crÃ­tica (24/7 SLA)"
    echo "   â€¢ Times pequenos"
    echo "   â€¢ Foco em MTTR"
    echo "   â€¢ Executive dashboards"
}

function show_grafana_stack() {
    echo "ğŸ”¶ GRAFANA STACK"
    echo "================"
    echo ""
    echo "ğŸ“Š Componentes:"
    echo "   â€¢ Prometheus (metrics + alerts)"
    echo "   â€¢ Grafana (dashboards)"
    echo "   â€¢ Loki (log aggregation)"
    echo "   â€¢ Tempo (distributed tracing)"
    echo "   â€¢ Promtail (log shipping)"
    echo "   â€¢ AlertManager (notifications)"
    echo ""
    echo "âœ… Vantagens:"
    echo "   â€¢ Open source ecosystem"
    echo "   â€¢ Cost-effective (~$65/mÃªs)"
    echo "   â€¢ Full customization"
    echo "   â€¢ No vendor lock-in"
    echo "   â€¢ Long-term data retention"
    echo ""
    echo "âŒ Desvantagens:"
    echo "   â€¢ High operational overhead"
    echo "   â€¢ Complex setup"
    echo "   â€¢ Requires expertise"
    echo "   â€¢ Manual scaling"
    echo ""
    echo "ğŸ¯ Melhor para:"
    echo "   â€¢ Cost-conscious teams"
    echo "   â€¢ Custom requirements"
    echo "   â€¢ Learning/development"
    echo "   â€¢ Compliance needs"
}

function show_hybrid_strategy() {
    echo "ğŸ”„ ESTRATÃ‰GIA HÃBRIDA"
    echo "====================="
    echo ""
    echo "ğŸ¯ Abordagem Recomendada:"
    echo ""
    echo "ğŸ“ˆ PRODUÃ‡ÃƒO (Critical Path):"
    echo "   Primary:   Datadog SaaS"
    echo "   â€¢ Critical alerting (PagerDuty)"
    echo "   â€¢ Executive dashboards"
    echo "   â€¢ APM correlation"
    echo "   â€¢ 24/7 SLA support"
    echo ""
    echo "   Secondary: Grafana Stack"
    echo "   â€¢ Cost analysis (FinOps)"
    echo "   â€¢ Historical data (compliance)"
    echo "   â€¢ Custom business metrics"
    echo "   â€¢ Performance debugging"
    echo ""
    echo "ğŸ§ª STAGING/DEVELOPMENT:"
    echo "   Primary:   Grafana Stack"
    echo "   â€¢ Cost-effective development"
    echo "   â€¢ Learning playground"
    echo "   â€¢ Custom integrations"
    echo "   â€¢ Performance testing"
    echo ""
    echo "ğŸ’¡ BenefÃ­cios da EstratÃ©gia:"
    echo "   â€¢ ğŸ“‰ 37% reduÃ§Ã£o de custos vs Datadog puro"
    echo "   â€¢ ğŸš¨ Zero compromisso em alertas crÃ­ticos"
    echo "   â€¢ ğŸ“Š Flexibilidade para anÃ¡lises customizadas"
    echo "   â€¢ ğŸ“ Path de migraÃ§Ã£o gradual"
    echo "   â€¢ ğŸ“‹ Compliance com retenÃ§Ã£o longa"
}

function show_cost_comparison() {
    echo "ğŸ’° COMPARAÃ‡ÃƒO DE CUSTOS (mensal)"
    echo "================================="
    echo ""
    echo "ğŸ“Š DATADOG SaaS:"
    echo "   APM (5 hosts):        $155"
    echo "   Log Ingestion (100GB): $110"  
    echo "   Custom Metrics:        $60"
    echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "   Total Datadog:        $325"
    echo ""
    echo "ğŸ”¶ GRAFANA STACK:"
    echo "   Prometheus (EKS):      $30"
    echo "   Grafana (EKS):         $15"
    echo "   Loki (EKS):            $15"
    echo "   Tempo (EKS):           $15"
    echo "   S3 Storage:            $10"
    echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "   Total Grafana:         $65"
    echo ""
    echo "ğŸ”„ ESTRATÃ‰GIA HÃBRIDA:"
    echo "   Production (DD+GF):    $280"
    echo "   Staging (Grafana):     $65"
    echo "   Development (Grafana): $65"
    echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "   Total HÃ­brido:        $410"
    echo ""
    echo "ğŸ“ˆ ECONOMIA:"
    echo "   Grafana vs Datadog:   80% economia"
    echo "   HÃ­brido vs Datadog:   37% economia"
    echo ""
    echo "âš ï¸  CUSTOS OCULTOS (Grafana):"
    echo "   Setup inicial:         $2,000-5,000"
    echo "   Operational (SRE):     $3,000-5,000/mÃªs"
    echo "   Training:              $2,000-8,000"
    echo ""
    echo "ğŸ’¡ RECOMENDAÃ‡ÃƒO:"
    echo "   â€¢ Start: Datadog (time-to-market)"
    echo "   â€¢ Scale: HÃ­brido (cost optimization)"
    echo "   â€¢ Mature: Avalie migraÃ§Ã£o gradual"
}

function show_implementation_guide() {
    echo "ğŸš€ GUIA DE IMPLEMENTAÃ‡ÃƒO"
    echo "========================"
    echo ""
    echo "ğŸ“‹ FASE 1: Datadog Setup (Semana 1-2)"
    echo "   1. Deploy Datadog Cluster Agent"
    echo "   2. Configure APM agentless"
    echo "   3. Setup CloudWatch log forwarding"
    echo "   4. Create Golden Signals dashboards"
    echo "   5. Configure critical alerts"
    echo ""
    echo "ğŸ“‹ FASE 2: Grafana Pilot (Semana 3-6)"
    echo "   1. Deploy Prometheus + Grafana"
    echo "   2. Configure /metrics scraping"
    echo "   3. Setup Loki + Promtail"
    echo "   4. Implement OpenTelemetry (Tempo)"
    echo "   5. Create custom dashboards"
    echo ""
    echo "ğŸ“‹ FASE 3: EstratÃ©gia HÃ­brida (Semana 7-8)"
    echo "   1. Dual-instrument applications"
    echo "   2. Route critical alerts to Datadog"
    echo "   3. Route analytics to Grafana"
    echo "   4. Setup cost monitoring"
    echo "   5. Train team on both stacks"
    echo ""
    echo "ğŸ“‹ FASE 4: OtimizaÃ§Ã£o (Ongoing)"
    echo "   1. Monitor costs vs value"
    echo "   2. Adjust sampling rates"
    echo "   3. Optimize retention policies"
    echo "   4. Evaluate migration paths"
    echo "   5. Regular stack health checks"
    echo ""
    echo "ğŸ”§ Ferramentas de Deploy:"
    echo "   â€¢ Datadog: Helm chart"
    echo "   â€¢ Grafana: kube-prometheus-stack"
    echo "   â€¢ Terraform: observability.tf module"
    echo "   â€¢ GitOps: ArgoCD applications"
}

function show_help() {
    echo "ğŸ” COMPARAÃ‡ÃƒO DE STACKS DE OBSERVABILIDADE"
    echo "==========================================="
    echo ""
    echo "ğŸ“‹ Uso: $0 [opÃ§Ã£o]"
    echo ""
    echo "ğŸ¯ OpÃ§Ãµes disponÃ­veis:"
    echo "   datadog     - Mostra detalhes da stack Datadog SaaS"
    echo "   grafana     - Mostra detalhes da stack Grafana"
    echo "   hibrido     - EstratÃ©gia hÃ­brida recomendada"
    echo "   custos      - ComparaÃ§Ã£o detalhada de custos"
    echo "   implementar - Guia de implementaÃ§Ã£o por fases"
    echo "   help        - Mostra esta ajuda"
    echo ""
    echo "ğŸ“Š Contexto do Projeto:"
    echo "   â€¢ Ambiente: AWS EKS Fargate + DynamoDB"
    echo "   â€¢ AplicaÃ§Ãµes: Backend Node.js + Frontend React + Mobile Expo"
    echo "   â€¢ Escala: 5 hosts, 100GB logs/mÃªs, mÃ©tricas customizadas"
    echo "   â€¢ Requisitos: 99.9% SLA, alertas 24/7, dashboards executivos"
    echo ""
    echo "ğŸ“š ReferÃªncias:"
    echo "   â€¢ Arquiteturas: docs/producao/arquitetura-*.drawio"
    echo "   â€¢ ConfiguraÃ§Ãµes: observabilidade/"
    echo "   â€¢ Custos: docs/producao/arquitetura-diagramas-mermaid.md"
}

# Processar argumentos
case "${1:-help}" in
    "datadog"|"dd")
        show_datadog_stack
        ;;
    
    "grafana"|"graf"|"prometheus")
        show_grafana_stack
        ;;
    
    "hibrido"|"hybrid"|"mix")
        show_hybrid_strategy
        ;;
    
    "custos"|"costs"|"financeiro")
        show_cost_comparison
        ;;
    
    "implementar"|"deploy"|"setup")
        show_implementation_guide
        ;;
    
    "help"|"-h"|"--help")
        show_help
        ;;
    
    *)
        echo "âŒ OpÃ§Ã£o invÃ¡lida: $1"
        echo ""
        show_help
        exit 1
        ;;
esac

echo ""
echo "ğŸ—ï¸  Arquitetura de ProduÃ§Ã£o AWS EKS + Observabilidade"
echo "ğŸ“ DocumentaÃ§Ã£o: docs/producao/"
echo "âš¡ Stack atual: Datadog SaaS + Grafana Stack (hÃ­brido)"